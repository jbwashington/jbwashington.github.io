<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>OpenGraph Inspector - Preview Social Media Cards</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', 'Roboto', 'Helvetica', 'Arial', sans-serif;
            background: #fdfdfd;
            color: #5c5c5c;
            line-height: 1.6;
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
        }

        header {
            margin-bottom: 30px;
        }

        h1 {
            color: #111111;
            font-size: 28px;
            font-weight: 500;
            margin-bottom: 10px;
        }

        p {
            color: #5c5c5c;
            font-size: 14px;
        }

        .input-section {
            background: white;
            border: 1px solid #d4d4d4;
            padding: 20px;
            margin-bottom: 20px;
        }

        .input-group {
            display: flex;
            gap: 10px;
            margin-bottom: 15px;
        }

        input[type="url"] {
            flex: 1;
            padding: 10px;
            border: 1px solid #d4d4d4;
            font-size: 14px;
            font-family: inherit;
        }

        input[type="url"]:focus {
            outline: none;
            border-color: #1e69d8;
        }

        button {
            background: white;
            color: #111111;
            border: 1px solid #d4d4d4;
            padding: 10px 20px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            font-family: inherit;
            transition: background-color 0.2s;
        }

        button:hover {
            background: #f6f8fa;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        .status {
            font-size: 13px;
            color: #5c5c5c;
            padding: 8px 0;
        }

        .status.error {
            color: #d73a49;
        }

        .status.success {
            color: #28a745;
        }

        .metadata-section {
            background: white;
            border: 1px solid #d4d4d4;
            padding: 20px;
            margin-bottom: 20px;
        }

        .metadata-section h2 {
            color: #111111;
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .metadata-grid {
            display: grid;
            gap: 10px;
        }

        .metadata-item {
            display: grid;
            grid-template-columns: 150px 1fr;
            gap: 10px;
            padding: 8px 0;
            border-bottom: 1px solid #f6f8fa;
        }

        .metadata-item:last-child {
            border-bottom: none;
        }

        .metadata-label {
            color: #111111;
            font-weight: 500;
            font-size: 13px;
        }

        .metadata-value {
            color: #5c5c5c;
            font-size: 13px;
            word-break: break-word;
        }

        .metadata-value a {
            color: #1e69d8;
            text-decoration: none;
        }

        .metadata-value a:hover {
            text-decoration: underline;
        }

        .previews-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 20px;
        }

        .preview-card {
            background: white;
            border: 1px solid #d4d4d4;
            padding: 20px;
        }

        .preview-card h3 {
            color: #111111;
            font-size: 16px;
            font-weight: 500;
            margin-bottom: 10px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .preview-dimensions {
            font-size: 11px;
            color: #5c5c5c;
            font-weight: 400;
        }

        .preview-frame {
            border: 1px solid #d4d4d4;
            background: #f6f8fa;
            overflow: hidden;
        }

        .preview-image {
            width: 100%;
            display: block;
            background: #e1e4e8;
        }

        .preview-content {
            padding: 12px;
            background: white;
        }

        .preview-title {
            color: #111111;
            font-size: 14px;
            font-weight: 500;
            margin-bottom: 4px;
        }

        .preview-description {
            color: #5c5c5c;
            font-size: 12px;
            line-height: 1.4;
            margin-bottom: 4px;
        }

        .preview-url {
            color: #5c5c5c;
            font-size: 11px;
            text-transform: uppercase;
        }

        .validation-section {
            background: white;
            border: 1px solid #d4d4d4;
            padding: 20px;
            margin-bottom: 20px;
        }

        .validation-section h2 {
            color: #111111;
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .validation-item {
            padding: 10px;
            margin-bottom: 8px;
            border: 1px solid #d4d4d4;
            font-size: 13px;
        }

        .validation-item.pass {
            background: #f0fff4;
            border-color: #28a745;
            color: #22863a;
        }

        .validation-item.warn {
            background: #fffbf0;
            border-color: #f9c513;
            color: #735c0f;
        }

        .validation-item.fail {
            background: #fff5f5;
            border-color: #d73a49;
            color: #cb2431;
        }

        .export-section {
            background: white;
            border: 1px solid #d4d4d4;
            padding: 20px;
        }

        .export-section h2 {
            color: #111111;
            font-size: 18px;
            font-weight: 500;
            margin-bottom: 15px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .loading {
            display: inline-block;
            width: 14px;
            height: 14px;
            border: 2px solid #d4d4d4;
            border-top-color: #1e69d8;
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            vertical-align: middle;
            margin-left: 8px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .hidden {
            display: none;
        }

        @media (max-width: 600px) {
            .previews-grid {
                grid-template-columns: 1fr;
            }

            .metadata-item {
                grid-template-columns: 1fr;
            }

            .input-group {
                flex-direction: column;
            }

            h1 {
                font-size: 24px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header>
            <h1>OpenGraph Inspector</h1>
            <p>Preview how your links appear across social media platforms, messaging apps, and SMS</p>
        </header>

        <div class="input-section">
            <div class="input-group">
                <input
                    type="url"
                    id="urlInput"
                    placeholder="https://example.com"
                    autocomplete="url"
                >
                <button id="inspectBtn">Inspect</button>
                <button id="clearBtn">Clear</button>
            </div>
            <div id="status" class="status"></div>
        </div>

        <div id="resultsContainer" class="hidden">
            <div class="metadata-section">
                <h2>OpenGraph Metadata</h2>
                <div id="metadataGrid" class="metadata-grid"></div>
            </div>

            <div class="validation-section">
                <h2>Validation Results</h2>
                <div id="validationResults"></div>
            </div>

            <div class="previews-grid" id="previewsGrid"></div>

            <div class="export-section">
                <h2>Export</h2>
                <div class="button-group">
                    <button id="exportJsonBtn">Download Metadata (JSON)</button>
                    <button id="copyMetaBtn">Copy Meta Tags</button>
                </div>
            </div>
        </div>
    </div>

    <script>
        const urlInput = document.getElementById('urlInput');
        const inspectBtn = document.getElementById('inspectBtn');
        const clearBtn = document.getElementById('clearBtn');
        const status = document.getElementById('status');
        const resultsContainer = document.getElementById('resultsContainer');
        const metadataGrid = document.getElementById('metadataGrid');
        const validationResults = document.getElementById('validationResults');
        const previewsGrid = document.getElementById('previewsGrid');
        const exportJsonBtn = document.getElementById('exportJsonBtn');
        const copyMetaBtn = document.getElementById('copyMetaBtn');

        let currentMetadata = null;

        // Platform specifications
        const platforms = {
            facebook: {
                name: 'Facebook',
                dimensions: '1200 × 630',
                aspectRatio: 1.91,
                idealWidth: 1200,
                idealHeight: 630
            },
            twitter: {
                name: 'Twitter',
                dimensions: '800 × 418',
                aspectRatio: 1.91,
                idealWidth: 800,
                idealHeight: 418
            },
            linkedin: {
                name: 'LinkedIn',
                dimensions: '1200 × 627',
                aspectRatio: 1.91,
                idealWidth: 1200,
                idealHeight: 627
            },
            whatsapp: {
                name: 'WhatsApp',
                dimensions: '300 × 157',
                aspectRatio: 1.91,
                idealWidth: 300,
                idealHeight: 157
            },
            slack: {
                name: 'Slack',
                dimensions: '800 × 418',
                aspectRatio: 1.91,
                idealWidth: 800,
                idealHeight: 418
            },
            imessage: {
                name: 'iMessage',
                dimensions: '300 × 157',
                aspectRatio: 1.91,
                idealWidth: 300,
                idealHeight: 157
            }
        };

        // Event listeners
        inspectBtn.addEventListener('click', inspectURL);
        clearBtn.addEventListener('click', clearResults);
        exportJsonBtn.addEventListener('click', exportJSON);
        copyMetaBtn.addEventListener('click', copyMetaTags);
        urlInput.addEventListener('keypress', (e) => {
            if (e.key === 'Enter') inspectURL();
        });

        async function inspectURL() {
            const url = urlInput.value.trim();

            if (!url) {
                showStatus('Please enter a URL', 'error');
                return;
            }

            if (!isValidURL(url)) {
                showStatus('Please enter a valid URL', 'error');
                return;
            }

            showStatus('Fetching metadata...', '');
            inspectBtn.disabled = true;

            try {
                const metadata = await fetchMetadata(url);
                currentMetadata = metadata;
                displayResults(metadata);
                showStatus('Metadata loaded successfully', 'success');
            } catch (error) {
                showStatus(`Error: ${error.message}`, 'error');
            } finally {
                inspectBtn.disabled = false;
            }
        }

        async function fetchMetadata(url) {
            // Try multiple CORS proxies
            const proxies = [
                `https://api.allorigins.win/raw?url=${encodeURIComponent(url)}`,
                `https://corsproxy.io/?${encodeURIComponent(url)}`
            ];

            let html = null;
            let lastError = null;

            for (const proxyUrl of proxies) {
                try {
                    const response = await fetch(proxyUrl);
                    if (response.ok) {
                        html = await response.text();
                        break;
                    }
                } catch (error) {
                    lastError = error;
                }
            }

            if (!html) {
                throw new Error('Unable to fetch URL. CORS proxy failed.');
            }

            return parseMetadata(html, url);
        }

        function parseMetadata(html, originalUrl) {
            const parser = new DOMParser();
            const doc = parser.parseFromString(html, 'text/html');

            const metadata = {
                url: originalUrl,
                og: {},
                twitter: {},
                general: {}
            };

            // Parse OpenGraph tags
            doc.querySelectorAll('meta[property^="og:"]').forEach(meta => {
                const property = meta.getAttribute('property').replace('og:', '');
                metadata.og[property] = meta.getAttribute('content');
            });

            // Parse Twitter Card tags
            doc.querySelectorAll('meta[name^="twitter:"]').forEach(meta => {
                const name = meta.getAttribute('name').replace('twitter:', '');
                metadata.twitter[name] = meta.getAttribute('content');
            });

            // Parse general meta tags
            const generalTags = ['description', 'keywords', 'author'];
            generalTags.forEach(tag => {
                const meta = doc.querySelector(`meta[name="${tag}"]`);
                if (meta) {
                    metadata.general[tag] = meta.getAttribute('content');
                }
            });

            // Get title
            metadata.general.title = doc.querySelector('title')?.textContent || '';

            // Get canonical URL
            const canonical = doc.querySelector('link[rel="canonical"]');
            if (canonical) {
                metadata.general.canonical = canonical.getAttribute('href');
            }

            return metadata;
        }

        function displayResults(metadata) {
            resultsContainer.classList.remove('hidden');

            // Display metadata
            displayMetadata(metadata);

            // Validate metadata
            validateMetadata(metadata);

            // Generate previews
            generatePreviews(metadata);

            // Scroll to results
            resultsContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        function displayMetadata(metadata) {
            metadataGrid.innerHTML = '';

            const items = [
                { label: 'URL', value: metadata.url, link: true },
                { label: 'Title', value: metadata.og.title || metadata.general.title },
                { label: 'Description', value: metadata.og.description || metadata.general.description },
                { label: 'Image', value: metadata.og.image, link: true },
                { label: 'Type', value: metadata.og.type || 'website' },
                { label: 'Site Name', value: metadata.og.site_name },
                { label: 'Twitter Card', value: metadata.twitter.card },
                { label: 'Twitter Site', value: metadata.twitter.site },
                { label: 'Canonical URL', value: metadata.general.canonical, link: true }
            ];

            items.forEach(item => {
                if (item.value) {
                    const div = document.createElement('div');
                    div.className = 'metadata-item';

                    const label = document.createElement('div');
                    label.className = 'metadata-label';
                    label.textContent = item.label;

                    const value = document.createElement('div');
                    value.className = 'metadata-value';

                    if (item.link) {
                        const link = document.createElement('a');
                        link.href = item.value;
                        link.target = '_blank';
                        link.textContent = item.value;
                        value.appendChild(link);
                    } else {
                        value.textContent = item.value;
                    }

                    div.appendChild(label);
                    div.appendChild(value);
                    metadataGrid.appendChild(div);
                }
            });
        }

        function validateMetadata(metadata) {
            validationResults.innerHTML = '';
            const validations = [];

            // Check for required OG tags
            if (metadata.og.title || metadata.general.title) {
                validations.push({ status: 'pass', message: 'Title is present' });
            } else {
                validations.push({ status: 'fail', message: 'Missing title tag' });
            }

            if (metadata.og.description || metadata.general.description) {
                validations.push({ status: 'pass', message: 'Description is present' });
            } else {
                validations.push({ status: 'warn', message: 'Missing description tag' });
            }

            if (metadata.og.image) {
                validations.push({ status: 'pass', message: 'OG image is present' });

                // Check image URL
                if (metadata.og.image.startsWith('http')) {
                    validations.push({ status: 'pass', message: 'Image URL is absolute' });
                } else {
                    validations.push({ status: 'warn', message: 'Image URL is relative (may not work on all platforms)' });
                }
            } else {
                validations.push({ status: 'fail', message: 'Missing OG image' });
            }

            if (metadata.og.url) {
                validations.push({ status: 'pass', message: 'OG URL is present' });
            } else {
                validations.push({ status: 'warn', message: 'Missing OG URL tag' });
            }

            if (metadata.og.type) {
                validations.push({ status: 'pass', message: `OG type is set to "${metadata.og.type}"` });
            }

            // Twitter Card validation
            if (metadata.twitter.card) {
                validations.push({ status: 'pass', message: `Twitter Card type: ${metadata.twitter.card}` });
            } else {
                validations.push({ status: 'warn', message: 'Missing Twitter Card type (will fall back to OG tags)' });
            }

            validations.forEach(validation => {
                const div = document.createElement('div');
                div.className = `validation-item ${validation.status}`;
                div.textContent = validation.message;
                validationResults.appendChild(div);
            });
        }

        function generatePreviews(metadata) {
            previewsGrid.innerHTML = '';

            const title = metadata.og.title || metadata.general.title || 'No title';
            const description = metadata.og.description || metadata.general.description || 'No description';
            const image = metadata.og.image || '';
            const url = new URL(metadata.url).hostname;

            Object.entries(platforms).forEach(([key, platform]) => {
                const card = document.createElement('div');
                card.className = 'preview-card';

                card.innerHTML = `
                    <h3>
                        ${platform.name}
                        <span class="preview-dimensions">${platform.dimensions}</span>
                    </h3>
                    <div class="preview-frame">
                        ${image ? `<img src="${image}" class="preview-image" alt="Preview" style="aspect-ratio: ${platform.aspectRatio};">` : '<div class="preview-image" style="aspect-ratio: ' + platform.aspectRatio + '; display: flex; align-items: center; justify-content: center; color: #999;">No image</div>'}
                        <div class="preview-content">
                            <div class="preview-title">${truncate(title, 70)}</div>
                            <div class="preview-description">${truncate(description, 150)}</div>
                            <div class="preview-url">${url}</div>
                        </div>
                    </div>
                `;

                previewsGrid.appendChild(card);
            });
        }

        function clearResults() {
            urlInput.value = '';
            resultsContainer.classList.add('hidden');
            currentMetadata = null;
            showStatus('', '');
        }

        function exportJSON() {
            if (!currentMetadata) return;

            const dataStr = JSON.stringify(currentMetadata, null, 2);
            const dataBlob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(dataBlob);
            const link = document.createElement('a');
            link.href = url;
            link.download = 'opengraph-metadata.json';
            link.click();
            URL.revokeObjectURL(url);

            showStatus('Metadata exported successfully', 'success');
        }

        function copyMetaTags() {
            if (!currentMetadata) return;

            const tags = [];

            // OpenGraph tags
            Object.entries(currentMetadata.og).forEach(([key, value]) => {
                tags.push(`<meta property="og:${key}" content="${escapeHtml(value)}">`);
            });

            // Twitter tags
            Object.entries(currentMetadata.twitter).forEach(([key, value]) => {
                tags.push(`<meta name="twitter:${key}" content="${escapeHtml(value)}">`);
            });

            const metaTagsStr = tags.join('\n');

            navigator.clipboard.writeText(metaTagsStr).then(() => {
                showStatus('Meta tags copied to clipboard', 'success');
            }).catch(() => {
                showStatus('Failed to copy meta tags', 'error');
            });
        }

        function isValidURL(string) {
            try {
                new URL(string);
                return true;
            } catch (_) {
                return false;
            }
        }

        function showStatus(message, type) {
            status.textContent = message;
            status.className = `status ${type}`;
        }

        function truncate(str, length) {
            if (!str) return '';
            return str.length > length ? str.substring(0, length) + '...' : str;
        }

        function escapeHtml(text) {
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }
    </script>
</body>
</html>
