<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Favicon Generator - SVG/PNG to All Icon Formats</title>
    <style>
        *, *::before, *::after {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
        }

        body {
            font-family: -apple-system, system-ui, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            background: #fdfdfd;
            color: #5c5c5c;
            line-height: 1.6;
            min-height: 100vh;
            padding: 30px 15px;
        }

        .container {
            max-width: 1000px;
            margin: 0 auto;
        }

        .header {
            margin-bottom: 40px;
            padding-bottom: 20px;
            border-bottom: 1px solid #d4d4d4;
        }

        .header h1 {
            font-size: 2rem;
            font-weight: 500;
            color: #111111;
            margin-bottom: 10px;
        }

        .header p {
            color: #5c5c5c;
        }

        /* Drop Zone */
        .drop-zone {
            border: 2px dashed #d4d4d4;
            padding: 60px 24px;
            text-align: center;
            margin-bottom: 30px;
            transition: border-color 0.15s, background-color 0.15s;
            cursor: pointer;
        }

        .drop-zone:hover {
            border-color: #5c5c5c;
        }

        .drop-zone.dragover {
            border-color: #1e69d8;
            background: #f6f8fa;
        }

        .drop-zone.has-image {
            padding: 24px;
        }

        .drop-zone input[type="file"] {
            display: none;
        }

        .drop-zone-text {
            color: #5c5c5c;
        }

        .drop-zone-text .primary {
            font-size: 1.1rem;
            color: #111111;
            margin-bottom: 8px;
        }

        .drop-zone-text .secondary {
            font-size: 0.875rem;
        }

        /* Preview */
        .preview-container {
            display: none;
            align-items: center;
            gap: 24px;
            flex-wrap: wrap;
        }

        .preview-container.visible {
            display: flex;
        }

        .preview-image {
            width: 128px;
            height: 128px;
            border: 1px solid #d4d4d4;
            background: repeating-conic-gradient(#f6f8fa 0% 25%, #fff 0% 50%) 50% / 16px 16px;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .preview-image img {
            max-width: 100%;
            max-height: 100%;
            object-fit: contain;
        }

        .preview-info {
            flex: 1;
            min-width: 200px;
        }

        .preview-info .filename {
            font-weight: 500;
            color: #111111;
            margin-bottom: 4px;
        }

        .preview-info .meta {
            font-size: 0.875rem;
            color: #5c5c5c;
        }

        .preview-actions {
            display: flex;
            gap: 8px;
        }

        /* Buttons */
        button {
            font-family: inherit;
            font-size: 0.875rem;
            padding: 10px 20px;
            border: 1px solid #d4d4d4;
            background: #fff;
            color: #5c5c5c;
            cursor: pointer;
            transition: background-color 0.15s;
        }

        button:hover {
            background: #f6f8fa;
        }

        button:disabled {
            opacity: 0.5;
            cursor: not-allowed;
        }

        button.primary {
            background: #111111;
            color: #fff;
            border-color: #111111;
        }

        button.primary:hover {
            background: #333;
        }

        /* Options */
        .options-section {
            background: #fff;
            border: 1px solid #d4d4d4;
            padding: 24px;
            margin-bottom: 30px;
        }

        .options-section h2 {
            font-size: 1rem;
            font-weight: 500;
            color: #111111;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #d4d4d4;
        }

        .options-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 12px;
        }

        .option-item {
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 0.875rem;
        }

        .option-item input[type="checkbox"] {
            width: 16px;
            height: 16px;
            cursor: pointer;
        }

        .option-item label {
            cursor: pointer;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .option-item .size {
            color: #5c5c5c;
            font-size: 0.75rem;
        }

        .option-group {
            margin-bottom: 20px;
        }

        .option-group:last-child {
            margin-bottom: 0;
        }

        .option-group-title {
            font-size: 0.75rem;
            font-weight: 500;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            color: #5c5c5c;
            margin-bottom: 12px;
        }

        /* Generated Output */
        .output-section {
            display: none;
            background: #fff;
            border: 1px solid #d4d4d4;
            padding: 24px;
            margin-bottom: 30px;
        }

        .output-section.visible {
            display: block;
        }

        .output-section h2 {
            font-size: 1rem;
            font-weight: 500;
            color: #111111;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 1px solid #d4d4d4;
        }

        /* Icon Grid */
        .icons-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(120px, 1fr));
            gap: 16px;
            margin-bottom: 24px;
        }

        .icon-item {
            text-align: center;
            padding: 16px 8px;
            border: 1px solid #d4d4d4;
            background: #fff;
        }

        .icon-preview {
            width: 64px;
            height: 64px;
            margin: 0 auto 12px;
            background: repeating-conic-gradient(#f6f8fa 0% 25%, #fff 0% 50%) 50% / 8px 8px;
            border: 1px solid #d4d4d4;
            display: flex;
            align-items: center;
            justify-content: center;
            overflow: hidden;
        }

        .icon-preview img,
        .icon-preview canvas {
            max-width: 100%;
            max-height: 100%;
            image-rendering: pixelated;
        }

        .icon-name {
            font-size: 0.75rem;
            color: #111111;
            word-break: break-all;
            margin-bottom: 4px;
        }

        .icon-size {
            font-size: 0.7rem;
            color: #5c5c5c;
        }

        .icon-download {
            font-size: 0.75rem;
            padding: 4px 8px;
            margin-top: 8px;
        }

        /* Code Output */
        .code-section {
            margin-top: 24px;
        }

        .code-section h3 {
            font-size: 0.875rem;
            font-weight: 500;
            color: #111111;
            margin-bottom: 12px;
        }

        .code-block {
            background: #222;
            color: #e6e6e6;
            padding: 16px;
            font-family: "SF Mono", Monaco, "Inconsolata", monospace;
            font-size: 0.8rem;
            overflow-x: auto;
            position: relative;
            margin-bottom: 16px;
        }

        .code-block pre {
            margin: 0;
            white-space: pre-wrap;
            word-break: break-all;
        }

        .code-block .copy-btn {
            position: absolute;
            top: 8px;
            right: 8px;
            font-size: 0.7rem;
            padding: 4px 8px;
            background: #444;
            border-color: #555;
            color: #e6e6e6;
        }

        .code-block .copy-btn:hover {
            background: #555;
        }

        /* Download Actions */
        .download-actions {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            padding-top: 16px;
            border-top: 1px solid #d4d4d4;
        }

        /* Footer */
        .footer {
            text-align: center;
            color: #5c5c5c;
            padding: 30px;
            border-top: 1px solid #d4d4d4;
            margin-top: 40px;
            font-size: 0.875rem;
        }

        .footer a {
            color: #1e69d8;
            text-decoration: none;
        }

        .footer a:hover {
            text-decoration: underline;
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 24px;
            right: 24px;
            background: #222;
            color: #e6e6e6;
            padding: 12px 20px;
            font-size: 0.875rem;
            z-index: 1000;
            animation: slideIn 0.2s ease-out;
        }

        @keyframes slideIn {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }

        /* Responsive */
        @media (max-width: 600px) {
            .header h1 {
                font-size: 1.5rem;
            }

            .preview-container {
                flex-direction: column;
                align-items: flex-start;
            }

            .icons-grid {
                grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            }

            .download-actions {
                flex-direction: column;
            }

            .download-actions button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <header class="header">
            <h1>Favicon Generator</h1>
            <p>Generate all favicon and app icon formats from a single SVG or PNG. Everything runs locally in your browser.</p>
        </header>

        <div class="drop-zone" id="dropZone">
            <div class="drop-zone-text" id="dropZoneText">
                <p class="primary">Drop SVG or PNG here</p>
                <p class="secondary">or click to browse</p>
            </div>
            <div class="preview-container" id="previewContainer">
                <div class="preview-image">
                    <img id="previewImage" src="" alt="Preview">
                </div>
                <div class="preview-info">
                    <div class="filename" id="fileName">-</div>
                    <div class="meta" id="fileMeta">-</div>
                </div>
                <div class="preview-actions">
                    <button onclick="clearImage()">Clear</button>
                    <button class="primary" onclick="generateIcons()">Generate Icons</button>
                </div>
            </div>
            <input type="file" id="fileInput" accept=".svg,.png,image/svg+xml,image/png">
        </div>

        <div class="options-section">
            <h2>Icon Formats</h2>

            <div class="option-group">
                <div class="option-group-title">Favicons</div>
                <div class="options-grid">
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="favicon.ico" data-sizes="16,32,48" checked>
                            favicon.ico <span class="size">16/32/48</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="favicon-16x16.png" data-sizes="16" checked>
                            favicon-16x16.png
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="favicon-32x32.png" data-sizes="32" checked>
                            favicon-32x32.png
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="favicon-48x48.png" data-sizes="48" checked>
                            favicon-48x48.png
                        </label>
                    </div>
                </div>
            </div>

            <div class="option-group">
                <div class="option-group-title">Apple</div>
                <div class="options-grid">
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="apple-touch-icon.png" data-sizes="180" checked>
                            apple-touch-icon.png <span class="size">180x180</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="apple-touch-icon-152x152.png" data-sizes="152">
                            apple-touch-icon <span class="size">152x152</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="apple-touch-icon-120x120.png" data-sizes="120">
                            apple-touch-icon <span class="size">120x120</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="safari-pinned-tab.svg" data-sizes="svg" id="safariSvg">
                            safari-pinned-tab.svg
                        </label>
                    </div>
                </div>
            </div>

            <div class="option-group">
                <div class="option-group-title">Android / PWA</div>
                <div class="options-grid">
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="android-chrome-192x192.png" data-sizes="192" checked>
                            android-chrome <span class="size">192x192</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="android-chrome-512x512.png" data-sizes="512" checked>
                            android-chrome <span class="size">512x512</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="android-chrome-maskable-192x192.png" data-sizes="192">
                            maskable <span class="size">192x192</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="android-chrome-maskable-512x512.png" data-sizes="512">
                            maskable <span class="size">512x512</span>
                        </label>
                    </div>
                </div>
            </div>

            <div class="option-group">
                <div class="option-group-title">Microsoft</div>
                <div class="options-grid">
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="mstile-70x70.png" data-sizes="70">
                            mstile <span class="size">70x70</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="mstile-150x150.png" data-sizes="150" checked>
                            mstile <span class="size">150x150</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="mstile-310x150.png" data-sizes="310x150">
                            mstile <span class="size">310x150</span>
                        </label>
                    </div>
                    <div class="option-item">
                        <label>
                            <input type="checkbox" name="icon" value="mstile-310x310.png" data-sizes="310">
                            mstile <span class="size">310x310</span>
                        </label>
                    </div>
                </div>
            </div>
        </div>

        <div class="output-section" id="outputSection">
            <h2>Generated Icons</h2>
            <div class="icons-grid" id="iconsGrid"></div>

            <div class="code-section">
                <h3>HTML (paste in head)</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode('htmlCode')">Copy</button>
                    <pre id="htmlCode"></pre>
                </div>

                <h3>site.webmanifest</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode('manifestCode')">Copy</button>
                    <pre id="manifestCode"></pre>
                </div>

                <h3>browserconfig.xml (Microsoft)</h3>
                <div class="code-block">
                    <button class="copy-btn" onclick="copyCode('browserConfig')">Copy</button>
                    <pre id="browserConfig"></pre>
                </div>
            </div>

            <div class="download-actions">
                <button class="primary" onclick="downloadZip()">Download All (ZIP)</button>
                <button onclick="downloadIndividual()">Download Icons Only</button>
            </div>
        </div>

        <footer class="footer">
            <p>Built by <a href="https://github.com/jbwashington">James Washington</a></p>
            <p style="margin-top: 8px;">All processing happens locally. Your images never leave your browser.</p>
        </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/jszip@3.10.1/dist/jszip.min.js"></script>
    <script>
        // State
        let sourceImage = null;
        let sourceType = null; // 'svg' or 'png'
        let sourceSvgText = null;
        let generatedIcons = {};

        // DOM Elements
        const dropZone = document.getElementById('dropZone');
        const dropZoneText = document.getElementById('dropZoneText');
        const previewContainer = document.getElementById('previewContainer');
        const previewImage = document.getElementById('previewImage');
        const fileInput = document.getElementById('fileInput');
        const fileName = document.getElementById('fileName');
        const fileMeta = document.getElementById('fileMeta');
        const outputSection = document.getElementById('outputSection');
        const iconsGrid = document.getElementById('iconsGrid');

        // Event Listeners
        dropZone.addEventListener('click', () => fileInput.click());
        dropZone.addEventListener('dragover', (e) => {
            e.preventDefault();
            dropZone.classList.add('dragover');
        });
        dropZone.addEventListener('dragleave', () => {
            dropZone.classList.remove('dragover');
        });
        dropZone.addEventListener('drop', (e) => {
            e.preventDefault();
            dropZone.classList.remove('dragover');
            const file = e.dataTransfer.files[0];
            if (file) handleFile(file);
        });
        fileInput.addEventListener('change', (e) => {
            const file = e.target.files[0];
            if (file) handleFile(file);
        });

        // Handle File Upload
        async function handleFile(file) {
            const validTypes = ['image/svg+xml', 'image/png'];
            if (!validTypes.includes(file.type) && !file.name.endsWith('.svg')) {
                showToast('Please upload an SVG or PNG file');
                return;
            }

            sourceType = file.type === 'image/png' ? 'png' : 'svg';

            if (sourceType === 'svg') {
                sourceSvgText = await file.text();
                document.getElementById('safariSvg').disabled = false;
            } else {
                sourceSvgText = null;
                document.getElementById('safariSvg').disabled = true;
                document.getElementById('safariSvg').checked = false;
            }

            const reader = new FileReader();
            reader.onload = (e) => {
                sourceImage = new Image();
                sourceImage.onload = () => {
                    previewImage.src = e.target.result;
                    fileName.textContent = file.name;
                    fileMeta.textContent = `${sourceImage.naturalWidth} x ${sourceImage.naturalHeight} • ${sourceType.toUpperCase()} • ${formatBytes(file.size)}`;

                    dropZoneText.style.display = 'none';
                    previewContainer.classList.add('visible');
                    dropZone.classList.add('has-image');
                };
                sourceImage.src = e.target.result;
            };
            reader.readAsDataURL(file);
        }

        // Clear Image
        function clearImage() {
            sourceImage = null;
            sourceType = null;
            sourceSvgText = null;
            generatedIcons = {};

            previewImage.src = '';
            fileName.textContent = '-';
            fileMeta.textContent = '-';
            fileInput.value = '';

            dropZoneText.style.display = 'block';
            previewContainer.classList.remove('visible');
            dropZone.classList.remove('has-image');
            outputSection.classList.remove('visible');
        }

        // Generate Icons
        async function generateIcons() {
            if (!sourceImage) {
                showToast('Please upload an image first');
                return;
            }

            generatedIcons = {};
            iconsGrid.innerHTML = '';

            const selectedIcons = Array.from(document.querySelectorAll('input[name="icon"]:checked'));

            if (selectedIcons.length === 0) {
                showToast('Please select at least one icon format');
                return;
            }

            for (const input of selectedIcons) {
                const iconName = input.value;
                const sizes = input.dataset.sizes;

                if (iconName === 'favicon.ico') {
                    // Generate multi-size ICO
                    const icoBlob = await generateIco([16, 32, 48]);
                    generatedIcons[iconName] = icoBlob;
                    addIconToGrid(iconName, await resizeImage(32), '16/32/48');
                } else if (iconName === 'safari-pinned-tab.svg') {
                    // Use original SVG
                    if (sourceSvgText) {
                        generatedIcons[iconName] = new Blob([sourceSvgText], { type: 'image/svg+xml' });
                        addIconToGrid(iconName, previewImage.src, 'SVG');
                    }
                } else if (sizes.includes('x')) {
                    // Non-square (e.g., 310x150)
                    const [w, h] = sizes.split('x').map(Number);
                    const dataUrl = await resizeImage(w, h);
                    generatedIcons[iconName] = await dataUrlToBlob(dataUrl);
                    addIconToGrid(iconName, dataUrl, `${w}x${h}`);
                } else {
                    // Square
                    const size = parseInt(sizes);
                    const dataUrl = await resizeImage(size);
                    generatedIcons[iconName] = await dataUrlToBlob(dataUrl);
                    addIconToGrid(iconName, dataUrl, `${size}x${size}`);
                }
            }

            // Generate code snippets
            generateCodeSnippets(selectedIcons);

            outputSection.classList.add('visible');
            outputSection.scrollIntoView({ behavior: 'smooth' });
            showToast(`Generated ${Object.keys(generatedIcons).length} icons`);
        }

        // Resize Image
        function resizeImage(width, height = width) {
            return new Promise((resolve) => {
                const canvas = document.createElement('canvas');
                canvas.width = width;
                canvas.height = height;
                const ctx = canvas.getContext('2d');

                // For best quality at small sizes
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                // Draw centered and scaled
                const scale = Math.min(width / sourceImage.naturalWidth, height / sourceImage.naturalHeight);
                const scaledWidth = sourceImage.naturalWidth * scale;
                const scaledHeight = sourceImage.naturalHeight * scale;
                const x = (width - scaledWidth) / 2;
                const y = (height - scaledHeight) / 2;

                ctx.drawImage(sourceImage, x, y, scaledWidth, scaledHeight);
                resolve(canvas.toDataURL('image/png'));
            });
        }

        // Generate ICO file (multi-size)
        async function generateIco(sizes) {
            const images = [];

            for (const size of sizes) {
                const canvas = document.createElement('canvas');
                canvas.width = size;
                canvas.height = size;
                const ctx = canvas.getContext('2d');
                ctx.imageSmoothingEnabled = true;
                ctx.imageSmoothingQuality = 'high';

                const scale = Math.min(size / sourceImage.naturalWidth, size / sourceImage.naturalHeight);
                const scaledWidth = sourceImage.naturalWidth * scale;
                const scaledHeight = sourceImage.naturalHeight * scale;
                const x = (size - scaledWidth) / 2;
                const y = (size - scaledHeight) / 2;

                ctx.drawImage(sourceImage, x, y, scaledWidth, scaledHeight);

                // Get raw RGBA data
                const imageData = ctx.getImageData(0, 0, size, size);
                images.push({ size, data: imageData });
            }

            // Build ICO file
            return buildIcoFile(images);
        }

        // Build ICO file format
        function buildIcoFile(images) {
            // ICO Header: 6 bytes
            // Image Directory: 16 bytes per image
            // Image Data: PNG data for each image

            const pngBlobs = [];
            let totalSize = 6 + (16 * images.length);

            // Convert each image to PNG blob
            const pngPromises = images.map(async (img) => {
                const canvas = document.createElement('canvas');
                canvas.width = img.size;
                canvas.height = img.size;
                const ctx = canvas.getContext('2d');
                ctx.putImageData(img.data, 0, 0);

                return new Promise((resolve) => {
                    canvas.toBlob((blob) => {
                        blob.arrayBuffer().then((buffer) => {
                            resolve({ size: img.size, buffer: new Uint8Array(buffer) });
                        });
                    }, 'image/png');
                });
            });

            return Promise.all(pngPromises).then((pngs) => {
                // Calculate offsets
                let offset = 6 + (16 * pngs.length);
                const entries = pngs.map((png) => {
                    const entry = { size: png.size, buffer: png.buffer, offset };
                    offset += png.buffer.length;
                    return entry;
                });

                // Build the ICO file
                const totalLength = offset;
                const ico = new Uint8Array(totalLength);
                const view = new DataView(ico.buffer);

                // ICO Header
                view.setUint16(0, 0, true); // Reserved
                view.setUint16(2, 1, true); // Type: 1 = ICO
                view.setUint16(4, entries.length, true); // Number of images

                // Image Directory Entries
                let dirOffset = 6;
                for (const entry of entries) {
                    const size = entry.size >= 256 ? 0 : entry.size;
                    ico[dirOffset] = size; // Width
                    ico[dirOffset + 1] = size; // Height
                    ico[dirOffset + 2] = 0; // Color palette
                    ico[dirOffset + 3] = 0; // Reserved
                    view.setUint16(dirOffset + 4, 1, true); // Color planes
                    view.setUint16(dirOffset + 6, 32, true); // Bits per pixel
                    view.setUint32(dirOffset + 8, entry.buffer.length, true); // Size of image data
                    view.setUint32(dirOffset + 12, entry.offset, true); // Offset to image data
                    dirOffset += 16;
                }

                // Image Data
                for (const entry of entries) {
                    ico.set(entry.buffer, entry.offset);
                }

                return new Blob([ico], { type: 'image/x-icon' });
            });
        }

        // Add icon to grid
        function addIconToGrid(name, dataUrl, sizeLabel) {
            const div = document.createElement('div');
            div.className = 'icon-item';
            div.innerHTML = `
                <div class="icon-preview">
                    <img src="${dataUrl}" alt="${name}">
                </div>
                <div class="icon-name">${name}</div>
                <div class="icon-size">${sizeLabel}</div>
                <button class="icon-download" onclick="downloadIcon('${name}')">Download</button>
            `;
            iconsGrid.appendChild(div);
        }

        // Generate code snippets
        function generateCodeSnippets(selectedIcons) {
            const iconNames = selectedIcons.map(i => i.value);

            // HTML
            let html = '';
            if (iconNames.includes('favicon.ico')) {
                html += '<link rel="icon" href="/favicon.ico" sizes="48x48">\n';
            }
            if (iconNames.includes('favicon-16x16.png')) {
                html += '<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">\n';
            }
            if (iconNames.includes('favicon-32x32.png')) {
                html += '<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">\n';
            }
            if (iconNames.includes('apple-touch-icon.png')) {
                html += '<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">\n';
            }
            if (iconNames.includes('safari-pinned-tab.svg')) {
                html += '<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#111111">\n';
            }
            if (iconNames.some(n => n.startsWith('android-chrome'))) {
                html += '<link rel="manifest" href="/site.webmanifest">\n';
            }
            if (iconNames.some(n => n.startsWith('mstile'))) {
                html += '<meta name="msapplication-TileColor" content="#ffffff">\n';
                html += '<meta name="msapplication-config" content="/browserconfig.xml">\n';
            }
            html += '<meta name="theme-color" content="#ffffff">';

            document.getElementById('htmlCode').textContent = html;

            // Manifest
            const manifest = {
                name: "Your App Name",
                short_name: "App",
                icons: [],
                theme_color: "#ffffff",
                background_color: "#ffffff",
                display: "standalone"
            };

            if (iconNames.includes('android-chrome-192x192.png')) {
                manifest.icons.push({ src: "/android-chrome-192x192.png", sizes: "192x192", type: "image/png" });
            }
            if (iconNames.includes('android-chrome-512x512.png')) {
                manifest.icons.push({ src: "/android-chrome-512x512.png", sizes: "512x512", type: "image/png" });
            }
            if (iconNames.includes('android-chrome-maskable-192x192.png')) {
                manifest.icons.push({ src: "/android-chrome-maskable-192x192.png", sizes: "192x192", type: "image/png", purpose: "maskable" });
            }
            if (iconNames.includes('android-chrome-maskable-512x512.png')) {
                manifest.icons.push({ src: "/android-chrome-maskable-512x512.png", sizes: "512x512", type: "image/png", purpose: "maskable" });
            }

            document.getElementById('manifestCode').textContent = JSON.stringify(manifest, null, 2);

            // Browser Config
            let browserConfig = '<?xml version="1.0" encoding="utf-8"?>\n<browserconfig>\n  <msapplication>\n    <tile>\n';
            if (iconNames.includes('mstile-70x70.png')) {
                browserConfig += '      <square70x70logo src="/mstile-70x70.png"/>\n';
            }
            if (iconNames.includes('mstile-150x150.png')) {
                browserConfig += '      <square150x150logo src="/mstile-150x150.png"/>\n';
            }
            if (iconNames.includes('mstile-310x150.png')) {
                browserConfig += '      <wide310x150logo src="/mstile-310x150.png"/>\n';
            }
            if (iconNames.includes('mstile-310x310.png')) {
                browserConfig += '      <square310x310logo src="/mstile-310x310.png"/>\n';
            }
            browserConfig += '      <TileColor>#ffffff</TileColor>\n    </tile>\n  </msapplication>\n</browserconfig>';

            document.getElementById('browserConfig').textContent = browserConfig;
        }

        // Download single icon
        async function downloadIcon(name) {
            const blob = generatedIcons[name];
            if (!blob) return;

            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = name;
            a.click();
            URL.revokeObjectURL(url);
        }

        // Download all as ZIP
        async function downloadZip() {
            const zip = new JSZip();

            // Add icons
            for (const [name, blob] of Object.entries(generatedIcons)) {
                zip.file(name, blob);
            }

            // Add manifest
            const manifestText = document.getElementById('manifestCode').textContent;
            zip.file('site.webmanifest', manifestText);

            // Add browserconfig
            const browserConfigText = document.getElementById('browserConfig').textContent;
            zip.file('browserconfig.xml', browserConfigText);

            // Add HTML snippet
            const htmlText = document.getElementById('htmlCode').textContent;
            zip.file('favicon-html.txt', htmlText);

            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'favicons.zip';
            a.click();
            URL.revokeObjectURL(url);

            showToast('Downloaded favicons.zip');
        }

        // Download icons only (no config files)
        async function downloadIndividual() {
            const zip = new JSZip();

            for (const [name, blob] of Object.entries(generatedIcons)) {
                zip.file(name, blob);
            }

            const content = await zip.generateAsync({ type: 'blob' });
            const url = URL.createObjectURL(content);
            const a = document.createElement('a');
            a.href = url;
            a.download = 'icons.zip';
            a.click();
            URL.revokeObjectURL(url);

            showToast('Downloaded icons.zip');
        }

        // Utility Functions
        function dataUrlToBlob(dataUrl) {
            return fetch(dataUrl).then(r => r.blob());
        }

        function formatBytes(bytes) {
            if (bytes < 1024) return bytes + ' B';
            if (bytes < 1024 * 1024) return (bytes / 1024).toFixed(1) + ' KB';
            return (bytes / (1024 * 1024)).toFixed(1) + ' MB';
        }

        function copyCode(elementId) {
            const text = document.getElementById(elementId).textContent;
            navigator.clipboard.writeText(text);
            showToast('Copied to clipboard');
        }

        function showToast(message) {
            const existing = document.querySelector('.toast');
            if (existing) existing.remove();

            const toast = document.createElement('div');
            toast.className = 'toast';
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>
</html>
